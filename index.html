<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ProductSaaS - Microservices E-commerce Dashboard</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/3144/3144456.png">
  
  <!-- Inter Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    /* ===== CSS VARIABLES & DESIGN SYSTEM ===== */
    :root {
      /* Color System - Semantic Tokens */
      --color-primary-50: #eff6ff;
      --color-primary-100: #dbeafe;
      --color-primary-500: #3b82f6;
      --color-primary-600: #2563eb;
      --color-primary-700: #1d4ed8;
      
      --color-success-50: #f0fdf4;
      --color-success-500: #10b981;
      --color-success-600: #059669;
      
      --color-warning-50: #fffbeb;
      --color-warning-500: #f59e0b;
      --color-warning-600: #d97706;
      
      --color-error-50: #fef2f2;
      --color-error-500: #ef4444;
      --color-error-600: #dc2626;
      
      --color-neutral-50: #f9fafb;
      --color-neutral-100: #f3f4f6;
      --color-neutral-200: #e5e7eb;
      --color-neutral-300: #d1d5db;
      --color-neutral-400: #9ca3af;
      --color-neutral-500: #6b7280;
      --color-neutral-600: #4b5563;
      --color-neutral-700: #374151;
      --color-neutral-800: #1f2937;
      --color-neutral-900: #111827;
      
      /* Semantic Colors - Dark Theme (Default) */
      --color-bg-primary: var(--color-neutral-900);
      --color-bg-secondary: var(--color-neutral-800);
      --color-bg-tertiary: var(--color-neutral-700);
      --color-bg-overlay: rgba(0, 0, 0, 0.75);
      --color-bg-elevated: var(--color-neutral-800);
      --color-bg-sidebar: var(--color-neutral-900);
      
      --color-text-primary: white;
      --color-text-secondary: var(--color-neutral-300);
      --color-text-tertiary: var(--color-neutral-400);
      --color-text-disabled: var(--color-neutral-500);
      
      --color-border: var(--color-neutral-700);
      --color-border-hover: var(--color-neutral-600);
      --color-border-light: var(--color-neutral-800);
      
      --color-shadow: rgba(0, 0, 0, 0.25);
      --color-shadow-lg: rgba(0, 0, 0, 0.35);
      
      /* Spacing Scale (8px grid) */
      --space-1: 4px;
      --space-2: 8px;
      --space-3: 12px;
      --space-4: 16px;
      --space-5: 20px;
      --space-6: 24px;
      --space-8: 32px;
      --space-10: 40px;
      --space-12: 48px;
      --space-16: 64px;
      
      /* Typography Scale */
      --text-xs: 12px;
      --text-sm: 14px;
      --text-base: 16px;
      --text-lg: 18px;
      --text-xl: 20px;
      --text-2xl: 24px;
      --text-3xl: 30px;
      --text-4xl: 36px;
      
      /* Border Radius */
      --radius-sm: 4px;
      --radius-md: 8px;
      --radius-lg: 12px;
      --radius-xl: 16px;
      --radius-2xl: 20px;
      --radius-full: 9999px;
      
      /* Transitions */
      --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
      --transition-base: 250ms cubic-bezier(0.4, 0, 0.2, 1);
      --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
      --transition-bounce: 500ms cubic-bezier(0.68, -0.55, 0.265, 1.55);
      
      /* Z-index Layers */
      --z-dropdown: 10;
      --z-sticky: 20;
      --z-modal: 30;
      --z-popover: 40;
      --z-toast: 50;
      --z-sidebar: 1000;
      --z-overlay: 999;
      
      /* Shadows */
      --shadow-sm: 0 1px 2px 0 var(--color-shadow);
      --shadow-md: 0 4px 6px -1px var(--color-shadow);
      --shadow-lg: 0 10px 15px -3px var(--color-shadow);
      --shadow-xl: 0 20px 25px -5px var(--color-shadow);
      --shadow-2xl: 0 25px 50px -12px var(--color-shadow);
      
      /* Blur Effects */
      --backdrop-blur: blur(8px);
      --backdrop-saturate: saturate(180%);
    }

    /* Light Theme Overrides */
    [data-theme="light"] {
      --color-bg-primary: var(--color-neutral-50);
      --color-bg-secondary: white;
      --color-bg-tertiary: var(--color-neutral-100);
      --color-bg-overlay: rgba(0, 0, 0, 0.5);
      --color-bg-elevated: white;
      --color-bg-sidebar: white;
      
      --color-text-primary: var(--color-neutral-900);
      --color-text-secondary: var(--color-neutral-600);
      --color-text-tertiary: var(--color-neutral-500);
      --color-text-disabled: var(--color-neutral-400);
      
      --color-border: var(--color-neutral-200);
      --color-border-hover: var(--color-neutral-300);
      --color-border-light: var(--color-neutral-100);
      
      --color-shadow: rgba(0, 0, 0, 0.08);
      --color-shadow-lg: rgba(0, 0, 0, 0.12);
    }

    /* ===== BASE STYLES ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      font-size: 16px;
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      scroll-behavior: smooth;
    }

    body {
      background-color: var(--color-bg-primary);
      color: var(--color-text-primary);
      transition: background-color var(--transition-base), color var(--transition-base);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* ===== ACCESSIBILITY ===== */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    :focus-visible {
      outline: 2px solid var(--color-primary-500);
      outline-offset: 2px;
      border-radius: var(--radius-sm);
    }

    /* ===== MOBILE OVERLAY ===== */
    .mobile-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--color-bg-overlay);
      z-index: var(--z-overlay);
      opacity: 0;
      visibility: hidden;
      transition: all var(--transition-base);
      backdrop-filter: blur(2px);
    }

    .mobile-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    /* ===== SIDEBAR ===== */
    .sidebar {
      width: 280px;
      background: var(--color-bg-sidebar);
      border-right: 1px solid var(--color-border);
      display: flex;
      flex-direction: column;
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      z-index: var(--z-sidebar);
      transform: translateX(-100%);
      transition: transform var(--transition-base) cubic-bezier(0.4, 0, 0.2, 1);
      overflow-y: auto;
    }

    @media (min-width: 1024px) {
      .sidebar {
        transform: translateX(0);
        position: fixed;
      }
      
      .main-content {
        margin-left: 280px;
      }
    }

    .sidebar.open {
      transform: translateX(0);
    }

    .sidebar-header {
      padding: var(--space-8) var(--space-6) var(--space-6);
      border-bottom: 1px solid var(--color-border);
      position: relative;
    }

    .close-sidebar {
      position: absolute;
      top: var(--space-6);
      right: var(--space-6);
      width: 32px;
      height: 32px;
      border-radius: var(--radius-md);
      border: 1px solid var(--color-border);
      background: var(--color-bg-secondary);
      color: var(--color-text-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all var(--transition-fast);
      display: none;
    }

    @media (max-width: 1023px) {
      .close-sidebar {
        display: flex;
      }
    }

    .close-sidebar:hover {
      border-color: var(--color-border-hover);
      color: var(--color-text-primary);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: var(--space-3);
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-lg);
      background: linear-gradient(135deg, var(--color-primary-500), var(--color-primary-700));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: var(--text-lg);
      box-shadow: var(--shadow-md);
    }

    .logo-text {
      display: flex;
      flex-direction: column;
    }

    .logo-title {
      font-size: var(--text-lg);
      font-weight: 700;
      color: var(--color-text-primary);
      line-height: 1.2;
    }

    .logo-subtitle {
      font-size: var(--text-xs);
      color: var(--color-text-tertiary);
      font-weight: 400;
    }

    .nav-container {
      flex: 1;
      padding: var(--space-6);
      overflow-y: auto;
    }

    .nav-section {
      margin-bottom: var(--space-8);
    }

    .nav-section-title {
      font-size: var(--text-xs);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--color-text-tertiary);
      margin-bottom: var(--space-3);
      padding: 0 var(--space-3);
    }

    .nav-list {
      list-style: none;
    }

    .nav-item {
      margin-bottom: var(--space-1);
    }

    .nav-link {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      padding: var(--space-3) var(--space-4);
      border-radius: var(--radius-lg);
      text-decoration: none;
      color: var(--color-text-secondary);
      transition: all var(--transition-fast);
      position: relative;
      overflow: hidden;
      cursor: pointer;
      border: none;
      background: transparent;
      width: 100%;
      text-align: left;
      font-family: inherit;
      font-size: inherit;
    }

    .nav-link::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--color-primary-500);
      opacity: 0;
      transition: opacity var(--transition-fast);
    }

    .nav-link:hover {
      background: var(--color-bg-tertiary);
      color: var(--color-text-primary);
      transform: translateX(4px);
    }

    .nav-link.active {
      background: rgba(59, 130, 246, 0.15);
      color: var(--color-primary-500);
      font-weight: 500;
    }

    .nav-link.active::before {
      opacity: 1;
    }

    .nav-icon {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      z-index: 1;
    }

    .nav-label {
      font-size: var(--text-sm);
      font-weight: 500;
      position: relative;
      z-index: 1;
      flex: 1;
    }

    .nav-badge {
      padding: 2px 8px;
      background: var(--color-error-500);
      color: white;
      border-radius: var(--radius-full);
      font-size: var(--text-xs);
      font-weight: 600;
      min-width: 20px;
      text-align: center;
      position: relative;
      z-index: 1;
    }

    .sidebar-footer {
      padding: var(--space-6);
      border-top: 1px solid var(--color-border);
      margin-top: auto;
    }

    .user-menu {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      position: relative;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      background: linear-gradient(135deg, var(--color-primary-500), var(--color-primary-700));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: var(--text-sm);
      box-shadow: var(--shadow-md);
      flex-shrink: 0;
    }

    .user-info {
      flex: 1;
      min-width: 0;
    }

    .user-name {
      font-size: var(--text-sm);
      font-weight: 600;
      color: var(--color-text-primary);
      margin-bottom: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .user-email {
      font-size: var(--text-xs);
      color: var(--color-text-tertiary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      cursor: pointer;
      transition: color var(--transition-fast);
    }

    .user-email:hover {
      color: var(--color-primary-500);
    }

    .user-actions {
      display: flex;
      gap: var(--space-2);
      margin-left: auto;
    }

    .logout-btn {
      width: 36px;
      height: 36px;
      border-radius: var(--radius-md);
      border: 1px solid var(--color-border);
      background: var(--color-bg-secondary);
      color: var(--color-text-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all var(--transition-fast);
      flex-shrink: 0;
    }

    .logout-btn:hover {
      background: var(--color-error-50);
      border-color: var(--color-error-300);
      color: var(--color-error-500);
      transform: scale(1.05);
    }

    /* ===== MAIN CONTENT ===== */
    .main-content {
      flex: 1;
      min-width: 0;
      transition: margin-left var(--transition-base);
    }

    .top-bar {
      position: sticky;
      top: 0;
      z-index: var(--z-sticky);
      background: rgba(31, 41, 55, 0.95);
      backdrop-filter: var(--backdrop-blur);
      border-bottom: 1px solid var(--color-border);
      padding: var(--space-4) var(--space-6);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    [data-theme="light"] .top-bar {
      background: rgba(255, 255, 255, 0.95);
    }

    .mobile-menu-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: var(--radius-md);
      border: 1px solid var(--color-border);
      background: var(--color-bg-secondary);
      color: var(--color-text-secondary);
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    @media (min-width: 1024px) {
      .mobile-menu-btn {
        display: none;
      }
    }

    .mobile-menu-btn:hover {
      border-color: var(--color-border-hover);
      color: var(--color-text-primary);
      transform: scale(1.05);
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: var(--space-3);
    }

    /* ===== BUTTON SYSTEM ===== */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-2);
      padding: var(--space-3) var(--space-5);
      border-radius: var(--radius-lg);
      border: 1px solid transparent;
      font-family: inherit;
      font-size: var(--text-sm);
      font-weight: 600;
      line-height: 1;
      cursor: pointer;
      transition: all var(--transition-fast);
      user-select: none;
      outline: none;
      position: relative;
      overflow: hidden;
    }

    .btn::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 5px;
      height: 5px;
      background: rgba(255, 255, 255, 0.5);
      opacity: 0;
      border-radius: 100%;
      transform: scale(1, 1) translate(-50%);
      transform-origin: 50% 50%;
    }

    .btn:focus:not(:active)::after {
      animation: ripple 1s ease-out;
    }

    @keyframes ripple {
      0% {
        transform: scale(0, 0);
        opacity: 0.5;
      }
      100% {
        transform: scale(20, 20);
        opacity: 0;
      }
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--color-primary-500), var(--color-primary-600));
      color: white;
      box-shadow: var(--shadow-md);
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, var(--color-primary-600), var(--color-primary-700));
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .btn-primary:active {
      transform: translateY(0);
      box-shadow: var(--shadow-md);
    }

    .btn-secondary {
      background: var(--color-bg-tertiary);
      color: var(--color-text-primary);
      border-color: var(--color-border);
    }

    .btn-secondary:hover {
      background: var(--color-bg-secondary);
      border-color: var(--color-border-hover);
      transform: translateY(-1px);
    }

    .btn-icon {
      width: 40px;
      height: 40px;
      padding: 0;
      border-radius: var(--radius-md);
    }

    .btn-sm {
      padding: var(--space-2) var(--space-3);
      font-size: var(--text-xs);
    }

    /* ===== CONTENT AREA ===== */
    .content-container {
      padding: var(--space-6);
      max-width: 1400px;
      margin: 0 auto;
      width: 100%;
      min-height: calc(100vh - 80px);
    }

    /* ===== PAGE HEADER ===== */
    .page-header {
      margin-bottom: var(--space-8);
      animation: fadeInUp 0.5s ease-out;
    }

    .page-title {
      font-size: var(--text-3xl);
      font-weight: 700;
      margin-bottom: var(--space-2);
      background: linear-gradient(135deg, var(--color-text-primary), var(--color-primary-500));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .page-description {
      color: var(--color-text-secondary);
      font-size: var(--text-lg);
      max-width: 600px;
    }

    /* ===== VIEW CONTENT ===== */
    .view-content {
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ===== DASHBOARD CONTENT ===== */
    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: var(--space-6);
      margin-bottom: var(--space-8);
    }

    .kpi-card {
      background: var(--color-bg-elevated);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-xl);
      padding: var(--space-6);
      transition: all var(--transition-base);
      position: relative;
      overflow: hidden;
      animation: fadeInUp 0.5s ease-out;
      animation-fill-mode: both;
    }

    .kpi-card:nth-child(1) { animation-delay: 0.1s; }
    .kpi-card:nth-child(2) { animation-delay: 0.2s; }
    .kpi-card:nth-child(3) { animation-delay: 0.3s; }
    .kpi-card:nth-child(4) { animation-delay: 0.4s; }

    .kpi-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--color-primary-500), transparent);
      opacity: 0;
      transition: opacity var(--transition-base);
    }

    .kpi-card:hover {
      border-color: var(--color-border-hover);
      transform: translateY(-4px);
      box-shadow: var(--shadow-xl);
    }

    .kpi-card:hover::before {
      opacity: 1;
    }

    .kpi-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: var(--space-4);
    }

    .kpi-icon {
      width: 48px;
      height: 48px;
      border-radius: var(--radius-lg);
      background: rgba(59, 130, 246, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-primary-500);
      font-size: var(--text-xl);
    }

    .kpi-trend {
      display: inline-flex;
      align-items: center;
      gap: var(--space-1);
      padding: var(--space-1) var(--space-3);
      border-radius: var(--radius-full);
      font-size: var(--text-xs);
      font-weight: 600;
    }

    .trend-up {
      background: rgba(16, 185, 129, 0.1);
      color: var(--color-success-500);
    }

    .trend-down {
      background: rgba(239, 68, 68, 0.1);
      color: var(--color-error-500);
    }

    .trend-neutral {
      background: rgba(245, 158, 11, 0.1);
      color: var(--color-warning-500);
    }

    .kpi-content {
      margin-top: var(--space-4);
    }

    .kpi-value {
      font-size: var(--text-3xl);
      font-weight: 700;
      margin-bottom: var(--space-2);
    }

    .kpi-label {
      font-size: var(--text-sm);
      color: var(--color-text-secondary);
      margin-bottom: var(--space-4);
    }

    .kpi-progress {
      height: 4px;
      background: var(--color-bg-tertiary);
      border-radius: var(--radius-full);
      overflow: hidden;
      margin-bottom: var(--space-3);
    }

    .kpi-progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--color-primary-500), var(--color-primary-600));
      border-radius: var(--radius-full);
      transition: width var(--transition-slow);
    }

    .kpi-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: var(--text-xs);
      color: var(--color-text-tertiary);
    }

    /* ===== PRODUCTS TABLE ===== */
    .table-container {
      background: var(--color-bg-elevated);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-xl);
      overflow: hidden;
      box-shadow: var(--shadow-md);
      animation: fadeInUp 0.5s ease-out;
    }

    .table-header {
      padding: var(--space-6);
      border-bottom: 1px solid var(--color-border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .table-title {
      font-size: var(--text-xl);
      font-weight: 600;
    }

    .products-table {
      width: 100%;
      border-collapse: collapse;
    }

    .products-table thead {
      background: var(--color-bg-tertiary);
    }

    .products-table th {
      padding: var(--space-4) var(--space-6);
      text-align: left;
      font-size: var(--text-sm);
      font-weight: 600;
      color: var(--color-text-secondary);
      border-bottom: 1px solid var(--color-border);
    }

    .products-table td {
      padding: var(--space-4) var(--space-6);
      border-bottom: 1px solid var(--color-border-light);
    }

    .products-table tbody tr {
      transition: background-color var(--transition-fast);
    }

    .products-table tbody tr:hover {
      background: var(--color-bg-tertiary);
    }

    .products-table tbody tr:last-child td {
      border-bottom: none;
    }

    .product-type {
      display: inline-flex;
      align-items: center;
      gap: var(--space-1);
      padding: var(--space-1) var(--space-3);
      border-radius: var(--radius-full);
      font-size: var(--text-xs);
      font-weight: 600;
    }

    .type-physical {
      background: rgba(59, 130, 246, 0.1);
      color: var(--color-primary-500);
    }

    .type-digital {
      background: rgba(16, 185, 129, 0.1);
      color: var(--color-success-500);
    }

    .type-service {
      background: rgba(245, 158, 11, 0.1);
      color: var(--color-warning-500);
    }

    .status-indicator {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: var(--radius-full);
      background: var(--color-success-500);
    }

    .status-dot.warning {
      background: var(--color-warning-500);
    }

    .status-dot.error {
      background: var(--color-error-500);
    }

    .table-actions {
      display: flex;
      gap: var(--space-2);
    }

    /* ===== ANALYTICS PAGE ===== */
    .analytics-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: var(--space-6);
      margin-bottom: var(--space-8);
    }

    @media (max-width: 1024px) {
      .analytics-grid {
        grid-template-columns: 1fr;
      }
    }

    .chart-container {
      background: var(--color-bg-elevated);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-xl);
      padding: var(--space-6);
      animation: fadeInUp 0.5s ease-out;
    }

    .chart-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--space-6);
    }

    .chart-title {
      font-size: var(--text-lg);
      font-weight: 600;
    }

    .chart-placeholder {
      height: 300px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--color-bg-tertiary);
      border-radius: var(--radius-lg);
      color: var(--color-text-tertiary);
      font-size: var(--text-sm);
    }

    .stats-list {
      display: flex;
      flex-direction: column;
      gap: var(--space-4);
    }

    .stat-item {
      background: var(--color-bg-elevated);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-lg);
      padding: var(--space-4);
      display: flex;
      align-items: center;
      gap: var(--space-4);
    }

    .stat-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-md);
      background: rgba(59, 130, 246, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-primary-500);
      font-size: var(--text-lg);
    }

    .stat-content {
      flex: 1;
    }

    .stat-value {
      font-size: var(--text-xl);
      font-weight: 700;
      margin-bottom: var(--space-1);
    }

    .stat-label {
      font-size: var(--text-sm);
      color: var(--color-text-secondary);
    }

    /* ===== PERFORMANCE PAGE ===== */
    .performance-metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: var(--space-6);
      margin-bottom: var(--space-8);
    }

    .metric-card {
      background: var(--color-bg-elevated);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-xl);
      padding: var(--space-6);
      text-align: center;
    }

    .metric-value {
      font-size: var(--text-4xl);
      font-weight: 700;
      margin-bottom: var(--space-2);
      color: var(--color-primary-500);
    }

    .metric-label {
      font-size: var(--text-sm);
      color: var(--color-text-secondary);
    }

    /* ===== API MANAGEMENT PAGE ===== */
    .api-endpoints {
      background: var(--color-bg-elevated);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-xl);
      overflow: hidden;
      margin-bottom: var(--space-8);
    }

    .endpoint-item {
      padding: var(--space-4) var(--space-6);
      border-bottom: 1px solid var(--color-border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .endpoint-item:last-child {
      border-bottom: none;
    }

    .endpoint-method {
      padding: var(--space-1) var(--space-3);
      border-radius: var(--radius-sm);
      font-size: var(--text-xs);
      font-weight: 600;
      margin-right: var(--space-3);
      min-width: 60px;
      text-align: center;
    }

    .method-get {
      background: rgba(59, 130, 246, 0.1);
      color: var(--color-primary-500);
    }

    .method-post {
      background: rgba(16, 185, 129, 0.1);
      color: var(--color-success-500);
    }

    .method-put {
      background: rgba(245, 158, 11, 0.1);
      color: var(--color-warning-500);
    }

    .method-delete {
      background: rgba(239, 68, 68, 0.1);
      color: var(--color-error-500);
    }

    .endpoint-path {
      font-family: 'Monaco', 'Consolas', monospace;
      color: var(--color-text-primary);
      flex: 1;
    }

    .endpoint-description {
      color: var(--color-text-secondary);
      font-size: var(--text-sm);
      margin-left: var(--space-4);
    }

    /* ===== SETTINGS PAGE ===== */
    .settings-section {
      background: var(--color-bg-elevated);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-xl);
      padding: var(--space-6);
      margin-bottom: var(--space-6);
    }

    .settings-section-title {
      font-size: var(--text-lg);
      font-weight: 600;
      margin-bottom: var(--space-4);
      color: var(--color-text-primary);
    }

    .settings-group {
      margin-bottom: var(--space-4);
    }

    .settings-label {
      display: block;
      margin-bottom: var(--space-2);
      font-weight: 500;
      color: var(--color-text-secondary);
    }

    .settings-control {
      width: 100%;
      padding: var(--space-3) var(--space-4);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-lg);
      background: var(--color-bg-secondary);
      color: var(--color-text-primary);
      font-family: inherit;
      font-size: var(--text-base);
    }

    /* ===== FACEBOOK-STYLE SKELETON LOADING ===== */
    .skeleton {
      position: relative;
      overflow: hidden;
      background: var(--color-bg-tertiary);
    }

    .skeleton::after {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      transform: translateX(-100%);
      background: linear-gradient(
        90deg,
        transparent 0%,
        rgba(255, 255, 255, 0.03) 20%,
        rgba(255, 255, 255, 0.08) 60%,
        transparent 100%
      );
      animation: shimmer 2s infinite;
    }

    [data-theme="light"] .skeleton::after {
      background: linear-gradient(
        90deg,
        transparent 0%,
        rgba(0, 0, 0, 0.02) 20%,
        rgba(0, 0, 0, 0.04) 60%,
        transparent 100%
      );
    }

    @keyframes shimmer {
      100% {
        transform: translateX(100%);
      }
    }

    .skeleton-kpi-card {
      height: 180px;
      border-radius: var(--radius-xl);
    }

    .skeleton-table-row {
      height: 56px;
      border-radius: var(--radius-md);
    }

    .skeleton-text {
      height: 1em;
      border-radius: var(--radius-sm);
      margin-bottom: var(--space-2);
    }

    .skeleton-text:last-child {
      margin-bottom: 0;
    }

    .skeleton-text.short {
      width: 60%;
    }

    .skeleton-text.medium {
      width: 80%;
    }

    .skeleton-chart {
      height: 300px;
      border-radius: var(--radius-lg);
    }

    /* ===== MODAL SYSTEM ===== */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--color-bg-overlay);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: var(--z-modal);
      opacity: 0;
      visibility: hidden;
      transition: all var(--transition-base);
      backdrop-filter: blur(4px);
    }

    .modal-overlay.open {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: var(--color-bg-elevated);
      border-radius: var(--radius-2xl);
      width: 90%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      transform: translateY(20px) scale(0.95);
      transition: transform var(--transition-base);
      box-shadow: var(--shadow-2xl);
      border: 1px solid var(--color-border);
    }

    .modal-overlay.open .modal {
      transform: translateY(0) scale(1);
    }

    .modal-header {
      padding: var(--space-6);
      border-bottom: 1px solid var(--color-border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .modal-title {
      font-size: var(--text-xl);
      font-weight: 700;
    }

    .modal-close {
      width: 36px;
      height: 36px;
      border-radius: var(--radius-md);
      border: none;
      background: var(--color-bg-tertiary);
      color: var(--color-text-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .modal-close:hover {
      background: var(--color-bg-primary);
      color: var(--color-text-primary);
      transform: rotate(90deg);
    }

    .modal-body {
      padding: var(--space-6);
    }

    /* ===== FORM SYSTEM ===== */
    .form-group {
      margin-bottom: var(--space-6);
    }

    .form-label {
      display: block;
      margin-bottom: var(--space-2);
      font-size: var(--text-sm);
      font-weight: 600;
      color: var(--color-text-secondary);
    }

    .form-control {
      width: 100%;
      padding: var(--space-3) var(--space-4);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-lg);
      background: var(--color-bg-secondary);
      color: var(--color-text-primary);
      font-family: inherit;
      font-size: var(--text-base);
      transition: all var(--transition-fast);
    }

    .form-control:focus {
      outline: none;
      border-color: var(--color-primary-500);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
    }

    .form-control::placeholder {
      color: var(--color-text-tertiary);
    }

    .form-actions {
      display: flex;
      gap: var(--space-3);
      margin-top: var(--space-8);
    }

    /* ===== TOAST NOTIFICATIONS ===== */
    .toast-container {
      position: fixed;
      bottom: var(--space-6);
      right: var(--space-6);
      z-index: var(--z-toast);
      display: flex;
      flex-direction: column;
      gap: var(--space-2);
    }

    .toast {
      background: var(--color-bg-elevated);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-xl);
      padding: var(--space-4);
      display: flex;
      align-items: center;
      gap: var(--space-3);
      min-width: 300px;
      box-shadow: var(--shadow-lg);
      animation: slideInRight var(--transition-base);
      border-left: 4px solid;
    }

    .toast-success {
      border-left-color: var(--color-success-500);
    }

    .toast-error {
      border-left-color: var(--color-error-500);
    }

    .toast-info {
      border-left-color: var(--color-primary-500);
    }

    .toast-icon {
      width: 24px;
      height: 24px;
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--text-sm);
      font-weight: 600;
    }

    .toast-success .toast-icon {
      background: rgba(16, 185, 129, 0.1);
      color: var(--color-success-500);
    }

    .toast-error .toast-icon {
      background: rgba(239, 68, 68, 0.1);
      color: var(--color-error-500);
    }

    .toast-info .toast-icon {
      background: rgba(59, 130, 246, 0.1);
      color: var(--color-primary-500);
    }

    .toast-content {
      flex: 1;
    }

    .toast-title {
      font-weight: 600;
      font-size: var(--text-sm);
      margin-bottom: 2px;
    }

    .toast-message {
      font-size: var(--text-sm);
      color: var(--color-text-secondary);
    }

    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* ===== THEME SWITCHER ===== */
    .theme-switcher {
      position: fixed;
      top: var(--space-2);
      right: var(--space-6);
      z-index: var(--z-sticky);
      background: var(--color-bg-elevated);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-full);
      padding: var(--space-2);
      display: flex;
      gap: var(--space-1);
      box-shadow: var(--shadow-lg);
      backdrop-filter: var(--backdrop-blur);
    }

    .theme-btn {
      width: 36px;
      height: 36px;
      border-radius: var(--radius-full);
      border: none;
      background: transparent;
      color: var(--color-text-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .theme-btn:hover {
      background: var(--color-bg-tertiary);
      color: var(--color-text-primary);
      transform: scale(1.1);
    }

    .theme-btn.active {
      background: var(--color-primary-500);
      color: white;
    }

    /* ===== SIGN-IN CONTAINER ===== */
    .signin-container {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      z-index: var(--z-modal);
      background: var(--color-bg-elevated);
      padding: var(--space-8);
      border-radius: var(--radius-2xl);
      box-shadow: var(--shadow-2xl);
      border: 1px solid var(--color-border);
      min-width: 350px;
    }

    .signin-icon {
      width: 80px;
      height: 80px;
      border-radius: var(--radius-full);
      background: linear-gradient(135deg, var(--color-primary-500), var(--color-primary-700));
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto var(--space-6);
      color: white;
      font-size: var(--text-2xl);
      font-weight: 700;
      box-shadow: var(--shadow-lg);
    }

    .signin-title {
      font-size: var(--text-2xl);
      font-weight: 700;
      margin-bottom: var(--space-2);
    }

    .signin-subtitle {
      color: var(--color-text-secondary);
      margin-bottom: var(--space-6);
    }

    #signinBtn {
      margin: 0 auto var(--space-4);
    }

    /* ===== LOADING OVERLAY ===== */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--color-bg-overlay);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: var(--z-modal);
      opacity: 0;
      visibility: hidden;
      transition: all var(--transition-base);
      backdrop-filter: blur(4px);
    }

    .loading-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .loading-spinner {
      width: 48px;
      height: 48px;
      border: 3px solid var(--color-bg-tertiary);
      border-top-color: var(--color-primary-500);
      border-radius: var(--radius-full);
      animation: spin 1s linear infinite;
      margin-bottom: var(--space-4);
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .loading-text {
      color: var(--color-text-secondary);
      font-size: var(--text-sm);
    }

    /* ===== EMPTY STATES ===== */
    .empty-state {
      padding: var(--space-12) var(--space-6);
      text-align: center;
    }

    .empty-icon {
      font-size: 64px;
      margin-bottom: var(--space-4);
      opacity: 0.3;
    }

    .empty-title {
      font-size: var(--text-xl);
      font-weight: 600;
      margin-bottom: var(--space-2);
      color: var(--color-text-secondary);
    }

    .empty-description {
      color: var(--color-text-tertiary);
      max-width: 400px;
      margin: 0 auto var(--space-6);
    }

    /* ===== RESPONSIVE DESIGN ===== */
    @media (max-width: 768px) {
      .content-container {
        padding: var(--space-4);
      }
      
      .kpi-grid {
        grid-template-columns: 1fr;
      }
      
      .table-header {
        flex-direction: column;
        gap: var(--space-3);
        align-items: stretch;
      }
      
      .products-table {
        display: block;
        overflow-x: auto;
      }
      
      .theme-switcher {
        top: var(--space-4);
        right: var(--space-4);
      }
      
      .page-title {
        font-size: var(--text-2xl);
      }
      
      .page-description {
        font-size: var(--text-base);
      }

      .header-actions {
        display: none;
      }

      .user-menu {
        flex-wrap: wrap;
      }

      .user-actions {
        margin-left: 0;
        margin-top: var(--space-2);
        width: 100%;
        justify-content: flex-end;
      }

      .signin-container {
        min-width: 90%;
        padding: var(--space-6);
        margin: 0 var(--space-4);
      }
    }

    @media (min-width: 769px) and (max-width: 1023px) {
      .kpi-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    /* ===== DARK MODE ADJUSTMENTS ===== */
    [data-theme="dark"] {
      color-scheme: dark;
    }

    [data-theme="light"] {
      color-scheme: light;
    }

    /* ===== UTILITY CLASSES ===== */
    .hidden {
      display: none !important;
    }
  </style>
</head>

<body>
  <!-- Mobile Overlay -->
  <div class="mobile-overlay" id="mobileOverlay"></div>

  <!-- App Container -->
  <div class="app-container">
    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <button class="close-sidebar" id="closeSidebar" aria-label="Close sidebar">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
        <div class="logo">
          <div class="logo-icon">PS</div>
          <div class="logo-text">
            <div class="logo-title">ProductSaaS</div>
            <div class="logo-subtitle">Microservices Platform</div>
          </div>
        </div>
      </div>

      <div class="nav-container">
        <!-- Analytics Section -->
        <div class="nav-section">
          <div class="nav-section-title">Analytics</div>
          <ul class="nav-list">
            <li class="nav-item">
              <button class="nav-link active" data-view="dashboard">
                <span class="nav-icon">üìä</span>
                <span class="nav-label">Dashboard</span>
              </button>
            </li>
            <li class="nav-item">
              <button class="nav-link" data-view="products">
                <span class="nav-icon">üì¶</span>
                <span class="nav-label">Products</span>
                <span class="nav-badge" id="productsBadge">0</span>
              </button>
            </li>
            <li class="nav-item">
              <button class="nav-link" data-view="performance">
                <span class="nav-icon">‚ö°</span>
                <span class="nav-label">Performance</span>
              </button>
            </li>
          </ul>
        </div>

        <!-- Management Section -->
        <div class="nav-section">
          <div class="nav-section-title">Management</div>
          <ul class="nav-list">
            <li class="nav-item">
              <button class="nav-link" data-view="api">
                <span class="nav-icon">üîß</span>
                <span class="nav-label">API Management</span>
              </button>
            </li>
            <li class="nav-item">
              <button class="nav-link" data-view="settings">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span class="nav-label">Settings</span>
              </button>
            </li>
          </ul>
        </div>
      </div>

      <div class="sidebar-footer">
        <div class="user-menu"> 
          <div class="user-avatar" id="userAvatar">U</div>
          <div class="user-info">
            <div class="user-name" id="userName">Loading...</div>
            <div class="user-email" id="userEmail">loading@example.com</div>
          </div>
          <div class="user-actions">
            <button class="logout-btn" id="logoutBtn" aria-label="Logout" title="Logout">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
      <!-- Top Bar -->
      <div class="top-bar">
        <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle menu">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
        </button>
        <div class="header-actions">
          <button class="btn btn-secondary btn-sm" id="refreshBtn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M23 4v6h-6"></path>
              <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
            </svg>
            Refresh
          </button>
        </div>

        <!-- Theme Switcher -->
        <div class="theme-switcher">
          <button class="theme-btn active" data-theme="dark" aria-label="Dark theme">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
          </button>
          <button class="theme-btn" data-theme="light" aria-label="Light theme">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="5"></circle>
              <line x1="12" y1="1" x2="12" y2="3"></line>
              <line x1="12" y1="21" x2="12" y2="23"></line>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
              <line x1="1" y1="12" x2="3" y2="12"></line>
              <line x1="21" y1="12" x2="23" y2="12"></line>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
          </button>
        </div>
      </div>

      <!-- Content Container -->
      <div class="content-container" id="contentContainer">
        <!-- Content will be dynamically loaded here -->
      </div>
    </main>
  </div>

  <!-- Sign-in Container (Shown when not logged in) -->
  <div class="signin-container" id="signinContainer">
    <div class="signin-icon">PS</div>
    <h2 class="signin-title">ProductSaaS Dashboard</h2>
    <p class="signin-subtitle">Sign in to access your dashboard</p>
    
    <!-- Sign In Button -->
    <button class="btn btn-primary" id="signinBtn">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
      </svg>
      Sign in with Google
    </button>
    
    <p style="margin-top: var(--space-4); color: var(--color-text-tertiary); font-size: var(--text-sm);">
      Sign in to manage your microservices e-commerce platform
    </p>
  </div>

  <!-- Create Product Modal -->
  <div class="modal-overlay" id="createProductModal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Create New Product</h2>
        <button class="modal-close" id="closeModalBtn" aria-label="Close modal">√ó</button>
      </div>
      <div class="modal-body">
        <form id="productForm">
          <div class="form-group">
            <label class="form-label" for="productName">Product Name</label>
            <input 
              type="text" 
              id="productName" 
              class="form-control" 
              placeholder="Enter product name"
              required
              autocomplete="off"
            >
          </div>
          <div class="form-group">
            <label class="form-label" for="productType">Product Type</label>
            <select id="productType" class="form-control" required>
              <option value="">Select type</option>
              <option value="physical">Physical Product</option>
              <option value="digital">Digital Product</option>
              <option value="service">Service</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="productMetadata">
              Metadata (Optional)
            </label>
            <textarea 
              id="productMetadata" 
              class="form-control" 
              rows="3"
              placeholder='{"category": "electronics", "price": 99.99}'
              aria-describedby="metadataHelp"
            ></textarea>
            <small id="metadataHelp" style="display: block; margin-top: var(--space-1); color: var(--color-text-tertiary);">
              Add additional product details in JSON format
            </small>
          </div>
          <div class="form-actions">
            <button type="button" class="btn btn-secondary" id="cancelBtn">Cancel</button>
            <button type="submit" class="btn btn-primary" id="submitBtn">Create Product</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <div class="loading-text">Loading...</div>
  </div>

  <script>
    // ===== CONFIGURATION =====
    const CONFIG = {
      endpoints: {
        products: 'https://saas-ecommvp-v1-api-products-service.onrender.com/products',
        health: 'https://saas-ecommvp-v1-api-products-service.onrender.com/health',
        database: 'https://vitrixlabph.pythonanywhere.com/health'
      },
      refreshInterval: 30000,
      skeletonDelay: 1000,
      logoutRedirectUrl: 'https://vitrixlab.github.io/SaaS-EcomMVP-UI-UX/home-v2.html',
      authRedirectUrl: 'YOUR_GOOGLE_AUTH_URL_HERE', // Your Google OAuth URL
      storageKeys: {
        user: 'productsaas_user',
        token: 'productsaas_token'
      }
    };

    // ===== STATE MANAGEMENT =====
    const state = {
      theme: localStorage.getItem('theme') || 'dark',
      products: [],
      isLoading: false,
      currentView: 'dashboard',
      serviceHealth: {
        products: 'unknown',
        database: 'unknown'
      },
      user: null,
      isAuthenticated: false
    };

    // ===== URL TOKEN PARSER =====
    const URLTokenParser = {
      parseTokenFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        const authSuccess = urlParams.get('auth_success');
        const tokenParam = urlParams.get('token');
        
        if (authSuccess === 'true' && tokenParam) {
          try {
            // The token is URL-encoded JSON, decode it
            const decodedToken = decodeURIComponent(tokenParam);
            const userData = JSON.parse(decodedToken);
            
            // Clean up URL by removing the auth parameters
            this.cleanURL();
            
            return userData;
          } catch (error) {
            console.error('Failed to parse token from URL:', error);
            return null;
          }
        }
        return null;
      },
      
      cleanURL() {
        // Remove auth parameters from URL without reloading
        const cleanUrl = window.location.pathname;
        window.history.replaceState({}, document.title, cleanUrl);
      }
    };

    // ===== USER MANAGEMENT =====
    const UserManager = {
      init() {
        // First check if we have a token in the URL (from Google OAuth redirect)
        const urlUserData = URLTokenParser.parseTokenFromURL();
        if (urlUserData) {
          this.saveUser(urlUserData);
          this.showDashboard();
          return;
        }
        
        // Then check localStorage for existing session
        this.loadUserFromStorage();
        if (state.user) {
          this.showDashboard();
        } else {
          this.showSignIn();
        }
      },
      
      loadUserFromStorage() {
        const userData = localStorage.getItem(CONFIG.storageKeys.user);
        if (userData) {
          try {
            state.user = JSON.parse(userData);
            state.isAuthenticated = true;
          } catch (error) {
            console.error('Failed to parse user data:', error);
            this.clearUser();
          }
        }
      },
      
      saveUser(userData) {
        state.user = {
          ...userData,
          loggedInAt: new Date().toISOString(),
          avatarText: this.getAvatarText(userData.name || userData.email)
        };
        
        localStorage.setItem(CONFIG.storageKeys.user, JSON.stringify(state.user));
        state.isAuthenticated = true;
        this.updateUserUI();
        
        UI.showToast(`Welcome, ${state.user.name}!`, 'success', 'Login Successful');
      },
      
      getAvatarText(nameOrEmail, email) {
        if (nameOrEmail && nameOrEmail.length >= 2) {
          return nameOrEmail.substring(0, 2).toUpperCase();
        }
        if (email && email.length >= 2) {
          return email.substring(0, 2).toUpperCase();
        }
        return 'U';
      },
      
      updateUserUI() {
        if (!state.user) return;
        
        // Update sidebar user info
        UI.$('#userAvatar').textContent = state.user.avatarText;
        UI.$('#userName').textContent = state.user.name || state.user.email.split('@')[0];
        UI.$('#userEmail').textContent = state.user.email;
        
        // Add click handler to email
        UI.$('#userEmail').addEventListener('click', () => {
          this.showUserProfile();
        });
      },
      
      showUserProfile() {
        if (!state.user) return;
        
        const lastLogin = new Date(state.user.loggedInAt).toLocaleString();
        alert(`User Profile\n\nName: ${state.user.name}\nEmail: ${state.user.email}\nLast Login: ${lastLogin}`);
      },
      
      clearUser() {
        state.user = null;
        state.isAuthenticated = false;
        localStorage.removeItem(CONFIG.storageKeys.user);
        localStorage.removeItem(CONFIG.storageKeys.token);
      },
      
      showDashboard() {
        UI.$('#signinContainer').style.display = 'none';
        UI.$('#mainContent').style.display = 'block';
        UI.$('#sidebar').style.display = 'flex';
        Navigation.init();
      },
      
      showSignIn() {
        UI.$('#signinContainer').style.display = 'block';
        UI.$('#mainContent').style.display = 'none';
        UI.$('#sidebar').style.display = 'none';
      },
      
      logout() {
        if (confirm('Are you sure you want to logout?')) {
          this.clearUser();
          // Redirect to home page
          window.location.href = CONFIG.logoutRedirectUrl;
        }
      }
    };

    // ===== UI UTILITIES =====
    const UI = {
      $(selector) { return document.querySelector(selector); },
      $$(selector) { return document.querySelectorAll(selector); },
      
      showLoading() {
        this.$('#loadingOverlay').classList.add('active');
      },
      
      hideLoading() {
        this.$('#loadingOverlay').classList.remove('active');
      },
      
      showToast(message, type = 'info', title = '') {
        const container = this.$('#toastContainer');
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        toast.innerHTML = `
          <div class="toast-icon">${type === 'success' ? '‚úì' : type === 'error' ? '!' : 'i'}</div>
          <div class="toast-content">
            ${title ? `<div class="toast-title">${title}</div>` : ''}
            <div class="toast-message">${message}</div>
          </div>
        `;
        
        container.appendChild(toast);
        
        setTimeout(() => {
          toast.style.opacity = '0';
          toast.style.transform = 'translateX(100%)';
          setTimeout(() => toast.remove(), 300);
        }, 5000);
      },
      
      formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', {
          month: 'short',
          day: 'numeric',
          year: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });
      },
      
      parseJSON(str, fallback = {}) {
        try {
          return JSON.parse(str);
        } catch {
          return fallback;
        }
      },
      
      openSidebar() {
        this.$('#sidebar').classList.add('open');
        this.$('#mobileOverlay').classList.add('active');
        document.body.style.overflow = 'hidden';
      },
      
      closeSidebar() {
        this.$('#sidebar').classList.remove('open');
        this.$('#mobileOverlay').classList.remove('active');
        document.body.style.overflow = '';
      }
    };

    // ===== THEME MANAGER =====
    const ThemeManager = {
      init() {
        this.setTheme(state.theme);
        this.setupEventListeners();
      },
      
      setTheme(theme) {
        state.theme = theme;
        document.documentElement.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);
        
        UI.$$('.theme-btn').forEach(btn => {
          btn.classList.toggle('active', btn.dataset.theme === theme);
        });
      },
      
      setupEventListeners() {
        UI.$$('.theme-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            this.setTheme(btn.dataset.theme);
          });
        });
      }
    };

    // ===== NAVIGATION MANAGER =====
    const Navigation = {
      init() {
        this.setupEventListeners();
        this.loadView('dashboard');
      },
      
      setupEventListeners() {
        // Navigation links
        UI.$$('.nav-link').forEach(link => {
          link.addEventListener('click', (e) => {
            e.preventDefault();
            const view = link.dataset.view;
            this.navigateTo(view);
          });
        });
        
        // Mobile menu
        UI.$('#mobileMenuBtn').addEventListener('click', () => {
          UI.openSidebar();
        });
        
        // Close sidebar buttons
        UI.$('#closeSidebar').addEventListener('click', () => {
          UI.closeSidebar();
        });
        
        UI.$('#mobileOverlay').addEventListener('click', () => {
          UI.closeSidebar();
        });
        
        // Logout button
        UI.$('#logoutBtn').addEventListener('click', () => {
          UserManager.logout();
        });
        
        // Sign in button
        UI.$('#signinBtn').addEventListener('click', () => {
          // Redirect to your Google OAuth URL
          if (CONFIG.authRedirectUrl && CONFIG.authRedirectUrl !== 'YOUR_GOOGLE_AUTH_URL_HERE') {
            window.location.href = CONFIG.authRedirectUrl;
          } else {
            // Demo login with the token from your URL
            const demoUser = {
              user_id: "688bd338-ff3d-455d-ae45-be6b9a421bb6",
              email: "soojidano@gmail.com",
              name: "Soo Ji Dano",
              timestamp: "2026-01-09T11:54:59.130845"
            };
            UserManager.saveUser(demoUser);
            UserManager.showDashboard();
          }
        });
        
        // Close sidebar on resize to desktop
        window.addEventListener('resize', () => {
          if (window.innerWidth >= 1024) {
            UI.closeSidebar();
          }
        });
      },
      
      navigateTo(view) {
        if (state.currentView === view) {
          UI.closeSidebar();
          return;
        }
        
        // Update active state
        UI.$$('.nav-link').forEach(link => {
          link.classList.toggle('active', link.dataset.view === view);
        });
        
        // Load view
        this.loadView(view);
        
        // Close sidebar on mobile
        if (window.innerWidth < 1024) {
          UI.closeSidebar();
        }
      },
      
      async loadView(view) {
        if (!state.isAuthenticated) return;
        
        state.currentView = view;
        
        // Show loading skeleton
        this.showSkeleton(view);
        
        // Load data if needed
        await this.loadViewData(view);
        
        // Render view
        this.renderView(view);
      },
      
      showSkeleton(view) {
        const container = UI.$('#contentContainer');
        let html = '';
        
        switch(view) {
          case 'dashboard':
            html = `
              <div class="page-header">
                <h1 class="page-title">Dashboard Overview</h1>
                <p class="page-description">Monitor your microservices architecture in real-time</p>
              </div>
              <div class="kpi-grid">
                ${Array(4).fill().map(() => `
                  <div class="kpi-card skeleton skeleton-kpi-card"></div>
                `).join('')}
              </div>
              <div class="table-container skeleton" style="height: 400px;"></div>
            `;
            break;
            
          case 'products':
            html = `
              <div class="page-header">
                <h1 class="page-title">Product Management</h1>
                <p class="page-description">Manage your e-commerce products</p>
              </div>
              <div class="table-container" style="min-height: 600px;">
                <div class="table-header">
                  <h2 class="table-title">All Products</h2>
                  <div>
                    <button class="btn btn-secondary btn-sm" disabled>Export</button>
                    <button class="btn btn-primary btn-sm" disabled>New Product</button>
                  </div>
                </div>
                <table class="products-table">
                  <thead>
                    <tr>
                      <th>Product</th>
                      <th>Type</th>
                      <th>Created</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    ${Array(5).fill().map(() => `
                      <tr>
                        <td><div class="skeleton skeleton-text medium"></div><div class="skeleton skeleton-text short"></div></td>
                        <td><div class="skeleton skeleton-text short"></div></td>
                        <td><div class="skeleton skeleton-text medium"></div></td>
                        <td><div class="skeleton skeleton-text short"></div></td>
                        <td><div class="skeleton skeleton-text short"></div></td>
                      </tr>
                    `).join('')}
                  </tbody>
                </table>
              </div>
            `;
            break;
            
          case 'performance':
            html = `
              <div class="page-header">
                <h1 class="page-title">Performance Analytics</h1>
                <p class="page-description">Monitor system performance and metrics</p>
              </div>
              <div class="performance-metrics">
                ${Array(6).fill().map(() => `
                  <div class="metric-card skeleton" style="height: 150px;"></div>
                `).join('')}
              </div>
              <div class="analytics-grid">
                <div class="chart-container skeleton skeleton-chart"></div>
                <div class="stats-list">
                  ${Array(4).fill().map(() => `
                    <div class="stat-item skeleton" style="height: 80px;"></div>
                  `).join('')}
                </div>
              </div>
            `;
            break;
            
          case 'api':
            html = `
              <div class="page-header">
                <h1 class="page-title">API Management</h1>
                <p class="page-description">Manage your microservices APIs</p>
              </div>
              <div class="api-endpoints skeleton" style="height: 400px;"></div>
              <div class="chart-container skeleton skeleton-chart"></div>
            `;
            break;
            
          case 'settings':
            html = `
              <div class="page-header">
                <h1 class="page-title">Settings</h1>
                <p class="page-description">Configure your application settings</p>
              </div>
              <div class="settings-section skeleton" style="height: 300px;"></div>
              <div class="settings-section skeleton" style="height: 200px;"></div>
            `;
            break;
        }
        
        container.innerHTML = html;
      },
      
      async loadViewData(view) {
        if (view === 'dashboard' || view === 'products') {
          try {
            const products = await ApiService.getProducts();
            state.products = products;
            UI.$('#productsBadge').textContent = products.length;
          } catch (error) {
            console.error('Failed to load products:', error);
          }
        }
      },
      
      renderView(view) {
        const container = UI.$('#contentContainer');
        let html = '';
        
        switch(view) {
          case 'dashboard':
            html = this.renderDashboard();
            break;
          case 'products':
            html = this.renderProducts();
            break;
          case 'performance':
            html = this.renderPerformance();
            break;
          case 'api':
            html = this.renderApi();
            break;
          case 'settings':
            html = this.renderSettings();
            break;
        }
        
        container.innerHTML = html;
        this.setupViewEvents(view);
      },
      
      renderDashboard() {
        const productsByType = state.products.reduce((acc, p) => {
          acc[p.type] = (acc[p.type] || 0) + 1;
          return acc;
        }, {});
        
        return `
          <div class="view-content">
            <div class="page-header">
              <h1 class="page-title">Dashboard Overview</h1>
              <p class="page-description">Welcome back, ${state.user?.name}! Monitor your microservices architecture in real-time</p>
            </div>
            
            <div class="kpi-grid">
              <div class="kpi-card">
                <div class="kpi-header">
                  <div class="kpi-icon">üì¶</div>
                  <div class="kpi-trend trend-up">‚Üë 12%</div>
                </div>
                <div class="kpi-content">
                  <div class="kpi-value">${state.products.length}</div>
                  <div class="kpi-label">Total Products</div>
                  <div class="kpi-progress">
                    <div class="kpi-progress-bar" style="width: ${Math.min(state.products.length * 10, 100)}%"></div>
                  </div>
                  <div class="kpi-footer">
                    <span>${productsByType.physical || 0} physical, ${productsByType.digital || 0} digital</span>
                    <span>${Math.min(state.products.length * 10, 100)}%</span>
                  </div>
                </div>
              </div>
              
              <div class="kpi-card">
                <div class="kpi-header">
                  <div class="kpi-icon">üë§</div>
                  <div class="kpi-trend trend-neutral">‚Üí</div>
                </div>
                <div class="kpi-content">
                  <div class="kpi-value">${state.user?.name?.split(' ')[0] || state.user?.email.split('@')[0] || 'User'}</div>
                  <div class="kpi-label">Current User</div>
                  <div class="kpi-progress">
                    <div class="kpi-progress-bar" style="width: 100%"></div>
                  </div>
                  <div class="kpi-footer">
                    <span>${state.user?.email || 'Not logged in'}</span>
                    <span>Active</span>
                  </div>
                </div>
              </div>
              
              <div class="kpi-card">
                <div class="kpi-header">
                  <div class="kpi-icon">üîß</div>
                  <div class="kpi-trend ${state.serviceHealth.products === 'healthy' ? 'trend-up' : 'trend-down'}">
                    ${state.serviceHealth.products === 'healthy' ? '‚Üë' : '‚Üì'}
                  </div>
                </div>
                <div class="kpi-content">
                  <div class="kpi-value">${state.serviceHealth.products === 'healthy' ? 'Operational' : 'Degraded'}</div>
                  <div class="kpi-label">Products Service</div>
                  <div class="kpi-progress">
                    <div class="kpi-progress-bar" style="width: ${state.serviceHealth.products === 'healthy' ? 100 : 30}%"></div>
                  </div>
                  <div class="kpi-footer">
                    <span>Render.com</span>
                    <span>${state.serviceHealth.products === 'healthy' ? 100 : 30}%</span>
                  </div>
                </div>
              </div>
              
              <div class="kpi-card">
                <div class="kpi-header">
                  <div class="kpi-icon">üíæ</div>
                  <div class="kpi-trend ${state.serviceHealth.database === 'healthy' ? 'trend-up' : 'trend-down'}">
                    ${state.serviceHealth.database === 'healthy' ? '‚Üë' : '‚Üì'}
                  </div>
                </div>
                <div class="kpi-content">
                  <div class="kpi-value">${state.serviceHealth.database === 'healthy' ? 'Connected' : 'Offline'}</div>
                  <div class="kpi-label">Database Service</div>
                  <div class="kpi-progress">
                    <div class="kpi-progress-bar" style="width: ${state.serviceHealth.database === 'healthy' ? 100 : 20}%"></div>
                  </div>
                  <div class="kpi-footer">
                    <span>PythonAnywhere</span>
                    <span>${state.serviceHealth.database === 'healthy' ? 100 : 20}%</span>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="table-container">
              <div class="table-header">
                <h2 class="table-title">Recent Products</h2>
                <div>
                  <button class="btn btn-secondary btn-sm" id="exportBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                      <polyline points="7 10 12 15 17 10"></polyline>
                      <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Export
                  </button>
                  <button class="btn btn-primary btn-sm" id="createProductBtn" style="margin-left: 8px;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <line x1="12" y1="5" x2="12" y2="19"></line>
                      <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    New Product
                  </button>
                </div>
              </div>
              ${this.renderProductsTable(state.products.slice(0, 5))}
            </div>
          </div>
        `;
      },
      
      renderProducts() {
        return `
          <div class="view-content">
            <div class="page-header">
              <h1 class="page-title">Product Management</h1>
              <p class="page-description">Manage your e-commerce products across the microservices architecture</p>
            </div>
            
            <div class="kpi-grid">
              <div class="kpi-card">
                <div class="kpi-header">
                  <div class="kpi-icon">üì¶</div>
                  <div class="kpi-trend trend-up">‚Üë</div>
                </div>
                <div class="kpi-content">
                  <div class="kpi-value">${state.products.length}</div>
                  <div class="kpi-label">Total Products</div>
                  <div class="kpi-progress">
                    <div class="kpi-progress-bar" style="width: ${Math.min(state.products.length * 10, 100)}%"></div>
                  </div>
                  <div class="kpi-footer">
                    <span>Across all categories</span>
                    <span>${Math.min(state.products.length * 10, 100)}%</span>
                  </div>
                </div>
              </div>
              
              <div class="kpi-card">
                <div class="kpi-header">
                  <div class="kpi-icon">üë§</div>
                  <div class="kpi-trend trend-neutral">‚Üí</div>
                </div>
                <div class="kpi-content">
                  <div class="kpi-value">${state.user?.name || state.user?.email.split('@')[0] || 'User'}</div>
                  <div class="kpi-label">Logged in as</div>
                  <div class="kpi-progress">
                    <div class="kpi-progress-bar" style="width: 100%"></div>
                  </div>
                  <div class="kpi-footer">
                    <span>${state.user?.email || 'Not logged in'}</span>
                    <span>Active</span>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="table-container">
              <div class="table-header">
                <h2 class="table-title">All Products</h2>
                <div>
                  <button class="btn btn-secondary btn-sm" id="refreshProductsBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M23 4v6h-6"></path>
                      <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                    </svg>
                    Refresh
                  </button>
                  <button class="btn btn-primary btn-sm" id="createProductBtn" style="margin-left: 8px;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <line x1="12" y1="5" x2="12" y2="19"></line>
                      <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    New Product
                  </button>
                </div>
              </div>
              ${this.renderProductsTable(state.products)}
            </div>
          </div>
        `;
      },
      
      renderPerformance() {
        return `
          <div class="view-content">
            <div class="page-header">
              <h1 class="page-title">Performance Analytics</h1>
              <p class="page-description">Monitor system performance and metrics</p>
            </div>
            
            <div class="performance-metrics">
              <div class="metric-card">
                <div class="metric-value">${state.products.length}</div>
                <div class="metric-label">Total Products</div>
              </div>
              <div class="metric-card">
                <div class="metric-value">&lt;50ms</div>
                <div class="metric-label">Avg Response Time</div>
              </div>
              <div class="metric-card">
                <div class="metric-value">95%</div>
                <div class="metric-label">Cache Hit Rate</div>
              </div>
              <div class="metric-card">
                <div class="metric-value">99.9%</div>
                <div class="metric-label">Uptime</div>
              </div>
            </div>
            
            <div class="analytics-grid">
              <div class="chart-container">
                <div class="chart-header">
                  <h3 class="chart-title">API Performance</h3>
                  <select class="form-control" style="width: auto; padding: 6px 12px;">
                    <option>Last 24 hours</option>
                    <option>Last 7 days</option>
                    <option>Last 30 days</option>
                  </select>
                </div>
                <div class="chart-placeholder">
                  üìà Performance Chart
                </div>
              </div>
              
              <div class="stats-list">
                <div class="stat-item">
                  <div class="stat-icon">‚ö°</div>
                  <div class="stat-content">
                    <div class="stat-value">&lt;100ms</div>
                    <div class="stat-label">Products API Response</div>
                  </div>
                </div>
                <div class="stat-item">
                  <div class="stat-icon">üíæ</div>
                  <div class="stat-content">
                    <div class="stat-value">${state.products.length}</div>
                    <div class="stat-label">Database Records</div>
                  </div>
                </div>
                <div class="stat-item">
                  <div class="stat-icon">üìà</div>
                  <div class="stat-content">
                    <div class="stat-value">98%</div>
                    <div class="stat-label">Success Rate</div>
                  </div>
                </div>
                <div class="stat-item">
                  <div class="stat-icon">üë§</div>
                  <div class="stat-content">
                    <div class="stat-value">${state.user?.name?.split(' ')[0] || state.user?.email.split('@')[0] || 'User'}</div>
                    <div class="stat-label">Current User</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
      },
      
      renderApi() {
        return `
          <div class="view-content">
            <div class="page-header">
              <h1 class="page-title">API Management</h1>
              <p class="page-description">Manage your microservices APIs</p>
            </div>
            
            <div class="api-endpoints">
              <div class="endpoint-item">
                <div>
                  <span class="endpoint-method method-get">GET</span>
                  <span class="endpoint-path">/products</span>
                </div>
                <div class="endpoint-description">Get all products</div>
              </div>
              <div class="endpoint-item">
                <div>
                  <span class="endpoint-method method-post">POST</span>
                  <span class="endpoint-path">/products</span>
                </div>
                <div class="endpoint-description">Create new product</div>
              </div>
              <div class="endpoint-item">
                <div>
                  <span class="endpoint-method method-get">GET</span>
                  <span class="endpoint-path">/products/{id}</span>
                </div>
                <div class="endpoint-description">Get specific product</div>
              </div>
              <div class="endpoint-item">
                <div>
                  <span class="endpoint-method method-put">PUT</span>
                  <span class="endpoint-path">/products/{id}</span>
                </div>
                <div class="endpoint-description">Update product</div>
              </div>
              <div class="endpoint-item">
                <div>
                  <span class="endpoint-method method-delete">DELETE</span>
                  <span class="endpoint-path">/products/{id}</span>
                </div>
                <div class="endpoint-description">Delete product</div>
              </div>
              <div class="endpoint-item">
                <div>
                  <span class="endpoint-method method-get">GET</span>
                  <span class="endpoint-path">/health</span>
                </div>
                <div class="endpoint-description">Service health check</div>
              </div>
            </div>
            
            <div class="chart-container" style="margin-top: 24px;">
              <div class="chart-header">
                <h3 class="chart-title">API Usage Statistics</h3>
              </div>
              <div class="chart-placeholder">
                üìä API Usage Chart
              </div>
            </div>
          </div>
        `;
      },
      
      renderSettings() {
        return `
          <div class="view-content">
            <div class="page-header">
              <h1 class="page-title">Settings</h1>
              <p class="page-description">Configure your application settings</p>
            </div>
            
            <div class="settings-section">
              <h3 class="settings-section-title">General Settings</h3>
              <div class="settings-group">
                <label class="settings-label">Application Name</label>
                <input type="text" class="settings-control" value="ProductSaaS Dashboard" disabled>
              </div>
              <div class="settings-group">
                <label class="settings-label">Default Theme</label>
                <select class="settings-control" id="themeSelect">
                  <option value="dark" ${state.theme === 'dark' ? 'selected' : ''}>Dark</option>
                  <option value="light" ${state.theme === 'light' ? 'selected' : ''}>Light</option>
                </select>
              </div>
            </div>
            
            <div class="settings-section">
              <h3 class="settings-section-title">User Settings</h3>
              <div class="settings-group">
                <label class="settings-label">Current User</label>
                <input type="text" class="settings-control" value="${state.user?.email || 'Not logged in'}" disabled>
              </div>
              <div class="settings-group">
                <label class="settings-label">User Role</label>
                <input type="text" class="settings-control" value="${state.user?.role || 'Admin'}" disabled>
              </div>
            </div>
            
            <div class="settings-section">
              <h3 class="settings-section-title">API Configuration</h3>
              <div class="settings-group">
                <label class="settings-label">Products Service URL</label>
                <input type="text" class="settings-control" value="${CONFIG.endpoints.products}" disabled>
              </div>
              <div class="settings-group">
                <label class="settings-label">Database Service URL</label>
                <input type="text" class="settings-control" value="${CONFIG.endpoints.database}" disabled>
              </div>
            </div>
            
            <div class="settings-section">
              <h3 class="settings-section-title">Data Management</h3>
              <button class="btn btn-secondary" id="clearCacheBtn" style="margin-right: 12px;">
                Clear Cache
              </button>
              <button class="btn btn-secondary" id="syncDataBtn">
                Sync with Database
              </button>
            </div>
          </div>
        `;
      },
      
      renderProductsTable(products) {
        if (products.length === 0) {
          return `
            <div class="empty-state">
              <div class="empty-icon">üì¶</div>
              <div class="empty-title">No products found</div>
              <div class="empty-description">Create your first product to get started</div>
              <button class="btn btn-primary" id="createFirstProductBtn">
                Create Product
              </button>
            </div>
          `;
        }
        
        return `
          <table class="products-table">
            <thead>
              <tr>
                <th>Product</th>
                <th>Type</th>
                <th>Created</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              ${products.map(product => {
                const metadata = UI.parseJSON(product.metadata || '{}');
                const typeClass = `type-${product.type}`;
                const typeLabel = product.type.charAt(0).toUpperCase() + product.type.slice(1);
                
                return `
                  <tr data-id="${product.id}">
                    <td>
                      <div style="font-weight: 600; margin-bottom: 2px;">${product.name}</div>
                      <div style="font-size: var(--text-sm); color: var(--color-text-tertiary);">
                        ${product.id}
                      </div>
                    </td>
                    <td>
                      <span class="product-type ${typeClass}">${typeLabel}</span>
                    </td>
                    <td>${UI.formatDate(product.created_at)}</td>
                    <td>
                      <div class="status-indicator">
                        <span class="status-dot"></span>
                        <span>Active</span>
                      </div>
                    </td>
                    <td>
                      <div class="table-actions">
                        <button class="btn btn-secondary btn-sm view-product-btn" data-id="${product.id}">
                          View
                        </button>
                        <button class="btn btn-secondary btn-sm delete-product-btn" data-id="${product.id}" style="background: rgba(239, 68, 68, 0.1); color: var(--color-error-500);">
                          Delete
                        </button>
                      </div>
                    </td>
                  </tr>
                `;
              }).join('')}
            </tbody>
          </table>
        `;
      },
      
      setupViewEvents(view) {
        // Setup create product button
        UI.$$('#createProductBtn').forEach(btn => {
          btn.addEventListener('click', () => ModalManager.open());
        });
        
        // Setup export button
        const exportBtn = UI.$('#exportBtn');
        if (exportBtn) {
          exportBtn.addEventListener('click', () => this.exportData());
        }
        
        // Setup refresh products button
        const refreshProductsBtn = UI.$('#refreshProductsBtn');
        if (refreshProductsBtn) {
          refreshProductsBtn.addEventListener('click', () => this.refreshProducts());
        }
        
        // Setup view product buttons
        UI.$$('.view-product-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const productId = e.target.dataset.id;
            this.viewProduct(productId);
          });
        });
        
        // Setup delete product buttons
        UI.$$('.delete-product-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const productId = e.target.dataset.id;
            this.deleteProduct(productId);
          });
        });
        
        // Setup settings events
        if (view === 'settings') {
          const themeSelect = UI.$('#themeSelect');
          if (themeSelect) {
            themeSelect.addEventListener('change', (e) => {
              ThemeManager.setTheme(e.target.value);
            });
          }
          
          const clearCacheBtn = UI.$('#clearCacheBtn');
          if (clearCacheBtn) {
            clearCacheBtn.addEventListener('click', () => {
              if (confirm('Clear all cached data?')) {
                localStorage.removeItem('theme');
                localStorage.removeItem(CONFIG.storageKeys.user);
                localStorage.removeItem(CONFIG.storageKeys.token);
                location.reload();
              }
            });
          }
        }
      },
      
      async viewProduct(productId) {
        const product = state.products.find(p => p.id === productId);
        if (product) {
          const metadata = UI.parseJSON(product.metadata || '{}');
          alert(`Product Details:\n\nID: ${product.id}\nName: ${product.name}\nType: ${product.type}\nCreated: ${UI.formatDate(product.created_at)}\nMetadata: ${JSON.stringify(metadata, null, 2)}`);
        }
      },
      
      async deleteProduct(productId) {
        if (confirm('Are you sure you want to delete this product? This action cannot be undone.')) {
          try {
            await ApiService.deleteProduct(productId);
            await this.refreshProducts();
            UI.showToast('Product deleted successfully', 'success', 'Deleted');
          } catch (error) {
            // Error handled by ApiService
          }
        }
      },

      /*
      async refreshProducts() {
        UI.showLoading();
        try {
          const products = await ApiService.getProducts();
          state.products = products;
          UI.$('#productsBadge').textContent = products.length;
          this.renderView(state.currentView);
        } catch (error) {
          console.error('Failed to refresh products:', error);
        } finally {
          UI.hideLoading();
        }
      },
      */
      
      async refreshProducts() {
      UI.showLoading();
      try {
        // üîÑ Trigger backend cache sync (equivalent to curl -X POST ...)
        await fetch(
          'https://saas-ecommvp-v1-api-products-service.onrender.com/cache/sync',
          { method: 'POST' }
        );
    
        // üì¶ Fetch refreshed products after sync
        const products = await ApiService.getProducts();
        state.products = products;
        UI.$('#productsBadge').textContent = products.length;
        this.renderView(state.currentView);
    
      } catch (error) {
        console.error('Failed to refresh products:', error);
      } finally {
        UI.hideLoading();
      }
    },

      exportData() {
        const dataStr = JSON.stringify(state.products, null, 2);
        const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
        const exportFileDefaultName = `products-${new Date().toISOString().split('T')[0]}.json`;
        
        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportFileDefaultName);
        linkElement.click();
        
        UI.showToast('Data exported successfully', 'success', 'Export Complete');
      }
    };

    // ===== API SERVICE =====
    const ApiService = {
      async fetchWithTimeout(url, options = {}, timeout = 5000) {
        const controller = new AbortController();
        const id = setTimeout(() => controller.abort(), timeout);
        
        try {
          const response = await fetch(url, {
            ...options,
            signal: controller.signal
          });
          clearTimeout(id);
          
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          return await response.json();
        } catch (error) {
          clearTimeout(id);
          throw error;
        }
      },
      
      async getProducts() {
        try {
          const data = await this.fetchWithTimeout(CONFIG.endpoints.products);
          return Array.isArray(data) ? data : [];
        } catch (error) {
          // Fallback to mock data
          return this.getMockProducts();
        }
      },
      
      async createProduct(productData) {
        try {
          const response = await this.fetchWithTimeout(CONFIG.endpoints.products, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(productData)
          });
          
          UI.showToast('Product created successfully', 'success', 'Success');
          return response;
        } catch (error) {
          UI.showToast('Failed to create product', 'error', 'Error');
          throw error;
        }
      },
      
      async deleteProduct(productId) {
        try {
          await this.fetchWithTimeout(`${CONFIG.endpoints.products}/${productId}`, {
            method: 'DELETE'
          });
          
          UI.showToast('Product deleted successfully', 'success', 'Success');
          return true;
        } catch (error) {
          UI.showToast('Failed to delete product', 'error', 'Error');
          throw error;
        }
      },
      
      async checkHealth() {
        const health = { products: 'unknown', database: 'unknown' };
        
        try {
          await this.fetchWithTimeout(CONFIG.endpoints.health);
          health.products = 'healthy';
        } catch {
          health.products = 'unreachable';
        }
        
        try {
          await this.fetchWithTimeout(CONFIG.endpoints.database);
          health.database = 'healthy';
        } catch {
          health.database = 'unreachable';
        }
        
        state.serviceHealth = health;
        return health;
      },
      
      getMockProducts() {
        return [
          {
            id: 'prod_1',
            name: 'Wireless Headphones Pro',
            type: 'physical',
            created_at: new Date().toISOString(),
            metadata: '{"category": "electronics", "price": 249.99}',
            status: 'active'
          },
          {
            id: 'prod_2',
            name: 'Python Masterclass E-book',
            type: 'digital',
            created_at: new Date(Date.now() - 86400000).toISOString(),
            metadata: '{"category": "education", "pages": 450}',
            status: 'active'
          },
          {
            id: 'prod_3',
            name: 'API Architecture Consultation',
            type: 'service',
            created_at: new Date(Date.now() - 172800000).toISOString(),
            metadata: '{"category": "consulting", "duration": "3 hours"}',
            status: 'active'
          }
        ];
      }
    };

    // ===== MODAL MANAGER =====
    const ModalManager = {
      init() {
        this.setupEventListeners();
      },
      
      setupEventListeners() {
        // Product form submission
        UI.$('#productForm').addEventListener('submit', async (e) => {
          e.preventDefault();
          await this.handleSubmit();
        });
        
        // Close modal buttons
        UI.$('#closeModalBtn').addEventListener('click', () => this.closeProductModal());
        UI.$('#cancelBtn').addEventListener('click', () => this.closeProductModal());
        
        // Close on overlay click
        UI.$('#createProductModal').addEventListener('click', (e) => {
          if (e.target === e.currentTarget) this.closeProductModal();
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            if (UI.$('#createProductModal').classList.contains('open')) {
              this.closeProductModal();
            }
          }
          if ((e.ctrlKey || e.metaKey) && e.key === 'n' && state.isAuthenticated) {
            e.preventDefault();
            this.open();
          }
        });
      },
      
      open() {
        UI.$('#createProductModal').classList.add('open');
        UI.$('#productName').focus();
      },
      
      closeProductModal() {
        UI.$('#createProductModal').classList.remove('open');
        UI.$('#productForm').reset();
      },
      
      async handleSubmit() {
        const productData = {
          name: UI.$('#productName').value.trim(),
          type: UI.$('#productType').value,
          metadata: UI.$('#productMetadata').value.trim() || {}
        };
        
        if (!productData.name || !productData.type) {
          UI.showToast('Please fill in all required fields', 'error', 'Validation Error');
          return;
        }
        
        if (productData.metadata && typeof productData.metadata === 'string') {
          try {
            productData.metadata = JSON.parse(productData.metadata);
          } catch {
            UI.showToast('Invalid JSON in metadata field', 'error', 'Validation Error');
            return;
          }
        }
        
        try {
          await ApiService.createProduct(productData);
          this.closeProductModal();
          await Navigation.refreshProducts();
        } catch (error) {
          // Error handled by ApiService
        }
      }
    };

    // ===== APPLICATION =====
    const App = {
      async init() {
        console.log('üöÄ Initializing ProductSaaS Dashboard...');
        
        // Initialize theme first
        ThemeManager.init();
        
        // Initialize user management (checks URL token first)
        UserManager.init();
        
        // Initialize Modal Manager
        ModalManager.init();
        
        // Setup refresh button
        UI.$('#refreshBtn').addEventListener('click', async () => {
          if (!state.isAuthenticated) return;
          UI.showToast('Refreshing data...', 'info', 'Refreshing');
          await Navigation.refreshProducts();
        });
        
        // Start auto-refresh if authenticated
        this.startAutoRefresh();
        
        console.log('‚úÖ Dashboard initialized successfully');
      },
      
      startAutoRefresh() {
        setInterval(async () => {
          if (state.isAuthenticated && !state.isLoading && document.visibilityState === 'visible') {
            await Navigation.refreshProducts();
          }
        }, CONFIG.refreshInterval);
      }
    };

    // ===== INITIALIZE =====
    document.addEventListener('DOMContentLoaded', () => App.init());

    // Global exports for debugging
    window.App = App;
    window.Navigation = Navigation;
    window.ApiService = ApiService;
    window.UserManager = UserManager;
  </script>
</body>
</html>
